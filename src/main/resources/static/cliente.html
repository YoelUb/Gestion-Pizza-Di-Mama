<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cliente - PizzerÃ­a Di Mama</title>
  <link rel="stylesheet" href="/css/styleCliente.css">
</head>
<body>
<header>ğŸ• Cliente - PizzerÃ­a Di Mama</header>
<section>
  <h2>ğŸ“œ Carta de Pizzas</h2>
  <div class="carta">
    <div class="pizza-card">
      <h3>Margarita</h3>
      <p>Queso mozzarella, tomate fresco y albahaca</p>
      <p>ğŸ’° 8.50 â‚¬</p>
    </div>
    <div class="pizza-card">
      <h3>Cuatro Quesos</h3>
      <p>Parmesano, gorgonzola, mozzarella y emmental</p>
      <p>ğŸ’° 9.90 â‚¬</p>
    </div>
    <div class="pizza-card">
      <h3>Hawaiana</h3>
      <p>JamÃ³n y piÃ±a</p>
      <p>ğŸ’° 9.50 â‚¬</p>
    </div>
    <div class="pizza-card">
      <h3>Vegetariana</h3>
      <p>Verduras frescas, cebolla, champiÃ±ones</p>
      <p>ğŸ’° 10.00 â‚¬</p>
    </div>
  </div>
</section>

<section>
  <h2>ğŸ“ Hacer un Pedido</h2>
  <form id="formPedido">
    <label for="cliente">Nombre del cliente</label>
    <input type="text" id="cliente" required>

    <label for="pizza">Tipo de pizza</label>
    <select id="pizza" required>
      <option disabled selected>Elige una pizza</option>
      <option value="Margarita">Margarita</option>
      <option value="Cuatro Quesos">Cuatro Quesos</option>
      <option value="Hawaiana">Hawaiana</option>
      <option value="Vegetariana">Vegetariana</option>
    </select>

    <label for="precio">Precio (â‚¬)</label>
    <input type="number" id="precio" step="0.01" required readonly>

    <label for="estado">Estado inicial</label>
    <select id="estado">
      <option>En preparaciÃ³n</option>
    </select>

    <button type="submit">Enviar pedido</button>
    <div class="success" id="mensajeExito"></div>
  </form>
</section>

<section>
  <h2>ğŸ” Revisa tu pedido</h2>
  <form id="revisarForm">
    <label for="buscarCliente">Nombre del cliente</label>
    <input type="text" id="buscarCliente" required>

    <label for="buscarId">ID del pedido</label>
    <input type="number" id="buscarId" required>

    <button type="submit">Buscar pedido</button>
  </form>

  <div id="resultadoPedido" style="margin-top: 1rem;"></div>
</section>
<section style="margin-top: 2rem;">
  <button class="btn-volver" onclick="window.location.href='index.html'">
    ğŸ  Volver al inicio
  </button>
</section>

<script>
  const preciosPizza = {
    "Margarita": 8.50,
    "Cuatro Quesos": 9.90,
    "Hawaiana": 9.50,
    "Vegetariana": 10.00
  };

  const pizzaSelect = document.getElementById("pizza");
  const precioInput = document.getElementById("precio");

  pizzaSelect.addEventListener("change", () => {
    const seleccion = pizzaSelect.value;
    precioInput.value = preciosPizza[seleccion] || "";
  });

  document.getElementById("formPedido").addEventListener("submit", function(e) {
    e.preventDefault();

    const pedido = {
      cliente: document.getElementById("cliente").value,
      pizza: pizzaSelect.value,
      precio: parseFloat(precioInput.value),
      estado: document.getElementById("estado").value
    };

    const mensaje = document.getElementById("mensajeExito");
    mensaje.textContent = "ğŸ’³ Procesando pago...";

    fetch("http://localhost:8080/api/pedidos", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(pedido)
    })
            .then(res => res.json())
            .then(data => {
              if (data.pedido) {
                setTimeout(() => {
                  mensaje.innerHTML = `âœ… Pedido pagado correctamente. Tu ID de pedido es: <b>#${data.pedido.id}</b>`;
                }, 1500);
                document.getElementById("formPedido").reset();
                precioInput.value = "";
              } else {
                mensaje.textContent = "âŒ Error al realizar el pedido.";
              }
            })
            .catch(() => {
              mensaje.textContent = "âŒ Error al conectar con el servidor.";
            });
  });

  document.getElementById("revisarForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const cliente = document.getElementById("buscarCliente").value;
    const id = document.getElementById("buscarId").value;

    fetch(`http://localhost:8080/api/pedidos/buscar?cliente=${cliente}&id=${id}`)
            .then(res => res.json())
            .then(pedido => {
              if (pedido && pedido.id) {
                document.getElementById("resultadoPedido").innerHTML =
                        `ğŸ“¦ Pedido #${pedido.id} de <b>${pedido.cliente}</b>:<br>
          ğŸ• Pizza: <b>${pedido.pizza}</b><br>
          ğŸ’¶ Precio: <b>${pedido.precio}â‚¬</b><br>
          ğŸ”„ Estado: <b>${pedido.estado}</b>`;
              } else {
                document.getElementById("resultadoPedido").innerText = "âŒ No se encontrÃ³ el pedido.";
              }
            })
            .catch(() => {
              document.getElementById("resultadoPedido").innerText = "âŒ Error al conectar con el servidor.";
            });
  });
</script>
</body>
</html>
